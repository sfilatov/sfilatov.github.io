---
layout: post
title: Postgres и правильная генерация отчетов CSV
date: '2011-07-07T07:03:00.000-07:00'
author: "Степан"
tags: 
modified_time: '2011-07-11T06:36:07.638-07:00'
blogger_id: tag:blogger.com,1999:blog-6563657311735677139.post-6276103047783483246
blogger_orig_url: http://sfilatov.blogspot.com/2011/07/postgres-csv.html
---

<span style="font-family:verdana;">Под правильной генерацией подразумеваем наиболее быструю по времени. Это актуально для больших БД.<br />Postgres как и MySQL поддерживает экспорт данных в файл.</span><br /><span style="font-family:verdana;">Прямой экспорт </span><span style="font-weight: bold; font-family:verdana;" >База Данных -&gt; Файл</span><span style="font-family:verdana;"> работает в любом случае быстрее связки </span><span style="font-weight: bold; font-family:verdana;" >База Данных -&gt; Ruby объекты в памяти -&gt; Файл</span><span style="font-family:verdana;">.</span><br /><br /><span style="font-family:verdana;">1) Первый вариант самый простой, если пользователь под которым работаем с БД входит в </span><span style="font-weight: bold; font-family:verdana;" >superusers</span><span style="font-family:verdana;">. </span><br /><br /><script src="https://gist.github.com/1069621.js?file=active_record_postgres_copy_1.rb"></script><br /><br /><span style="font-family:verdana;">2) Второй вариант чуть медленней, но позволяет работать под любым пользователем. Получаем прямое соединение с Postgres используя gem </span><span style="font-weight: bold; font-family:verdana;" >pg</span><span style="font-family:verdana;"> </span><br /><br /><script src="https://gist.github.com/1069621.js?file=active_record_postgres_copy_2.rb"></script><br /><br /><span style="font-family:arial;">Во втором варианте данные отдаются и копируются в STDOUT, а не в файл и становятся построчно доступны через прямое соединение. Также появляется возможность пост-обработать результаты запроса, удалить/заменить символы.</span>